server {
  listen       80;
  # listen       443 ssl http2; # FIXME: 启用证书后取消注释并配置 SSL
  server_name  localhost; # FIXME: 修改为实际的域名

  # 字符集设置
  charset utf-8;

  # 隐藏 nginx 版本信息（安全考虑）
  server_tokens off;

  # 安全响应头
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header X-XSS-Protection "1; mode=block" always;
  add_header Referrer-Policy "strict-origin-when-cross-origin" always;

  # HSTS策略,要求客户端采用https访问（仅在启用SSL后使用）
  # add_header Strict-Transport-Security "max-age=31536000;includeSubDomains;preload" always;

  # 上传文件的大小限制
  client_max_body_size 10M;

  # 启用缓冲区（用于反向代理场景）
  proxy_buffering on;

  # gzip压缩（已在主配置中配置，server 块中可覆盖）
  # 注意：gzip 配置通常放在 http 块中，这里仅作说明
  # 如需在 server 块中覆盖，可取消注释以下配置
  # gzip on;
  # gzip_comp_level 5;
  # gzip_min_length 1024;
  # gzip_buffers 16 8k;
  # gzip_proxied any;
  # gzip_vary on;
  # gzip_static on; # 预压缩（on: 如果预压缩文件不存在则动态压缩; always: 必须存在预压缩文件）
  # gzip_disable "MSIE [1-6]\.";
  # gzip_types text/plain text/css text/js text/xml text/javascript application/javascript application/json application/xml application/rss+xml image/svg+xml;

  # brotli压缩,需要启用SSL证书, 可以与gzip并存,优先采用brotli,不支持回退到gzip压缩
  # 注意：需要安装 nginx-module-brotli 模块
  # brotli on; # 启用brotli
  # brotli_comp_level 6; # 压缩级别 最大11
  # brotli_min_length 1k; # 大于等于1k执行压缩
  # brotli_buffers 16 8k; # 压缩缓冲区, 16个8k
  # brotli_vary on; # 告知客户端支持压缩
  # brotli_static always; # 是否允许查找已压缩好的.br文件
  # brotli_types text/plain text/css text/js text/xml text/javascript application/javascript application/json application/xml application/rss+xml image/svg+xml;

  # SSL配置（启用HTTPS时取消注释）
  # ssl_certificate /etc/nginx/ssl/xxx.pem; # 证书文件路径
  # ssl_certificate_key /etc/nginx/ssl/xxx.key; # 证书密钥文件路径
  # ssl_session_cache shared:SSL:10m; # 会话重用,提高https性能
  # ssl_session_timeout 5m; # 会话超时时间
  # ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; # 加密套件
  # ssl_protocols TLSv1.2 TLSv1.3; # 协议版本
  # ssl_prefer_server_ciphers on; # 启用服务器端加密套件优先

  # 负载均衡配置示例（通常放在 http 块中，这里仅作说明）
  # upstream backend {
  #   # 根据ip hash分配
  #   ip_hash;
  #   # 根据响应时间分配（需要安装 nginx-upstream-fair 模块）
  #   # fair;
  #   # 根据URL hash分配（需要安装 nginx-upstream-hash 模块）
  #   # url_hash;
  #   # hash_methods crc32;
  #   # 用法server 192.168.0.1:8080 [option],option可选,down表示不参与负载/weight=1,负载权重/backup当其他机器不可用或繁忙时启用
  #   server 192.168.0.1:8080;
  # }

  # location 匹配规则说明:
  # 1. 前缀匹配 location /test {} 要求以指定符号开始, 可以命中 host/test, host/test?key=value, host/test/, host/testtest
  # 2. 精确匹配 location =/test {} 精确匹配, 命中 host/test, host/test?key=value 不会匹配 host/test/, host/testtest
  # 3. 正则匹配 location ~^/test {} 或location ~*^/test {} 正则匹配,用在uri中包含正则表达式前,例如^/test,*用来设置不区分大小写
  # 4. 精确捕获匹配 location ^~ 等同于location /test {},只是命中后会停止匹配其他模式
  # 5. location @name {}, 定义location,以便内部定向使用
  # 6. 通配匹配 location / {}
  # 优先级: 粒度越细越优先, 精确匹配 > 精确捕获匹配 > 正则匹配 > 前缀匹配 > 通配匹配

  root   /usr/share/nginx/html; # FIXME: 修改为实际的资源部署位置

  # 静态资源缓存配置（使用 location 块替代 if 判断，性能更好）
  location ~* \.(?:js|css|gif|jpg|jpeg|webp|png|bmp|swf|woff2?|eot|otf|ttf|svg|apng|ico)$ {
    expires 90d;
    add_header Cache-Control "public, immutable";
    add_header Last-Modified $date_gmt;
    access_log off; # 静态资源访问日志可关闭以提升性能
  }

  # HTML 入口文件不缓存
  location ~* \.(?:htm|html)$ {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
  }

  # 主 location 块
  location / {
    index  index.html index.htm;
    try_files $uri $uri/ /index.html =404; # 路由history模式可以启用
  }

  # 设置出现对应的错误码后如何处理
  error_page   500 502 503 504  /50x.html;
  # =500的作用是将状态更改为500
  # error_page   500 502 503 504 =500 /50x.html;

  location = /50x.html {
    # root指定根路径 alias 路径别名, 例如: /usr/local/images/test.png 路径下有图片资源
    # location /images { root /usr/local; }, 此时访问路径为host/images/test.png
    # 如果使用alias: location /images { alias /usr/local; },host/images/test.png将不可访问,调整为location /images/ { alias /usr/local/images/; }
    # root的逻辑是: root路径+location路径,alias的逻辑是: 用alias路径替换location路径
    root   /usr/share/nginx/html;
    # 指定默认返回的首页,如果没指定具体资源,则多个值依次返回,找到1个返回为止
    index index.html index.htm;
  }

  # 禁止访问隐藏文件（安全考虑）
  location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
  }
}
