worker_processes auto; # 工作进程数

error_log /dev/stdout warn; # 指定日志输出路径与级别, 过低的日志级别会带来大量的I/O消耗

events {
  #accept_mutex on; # 规避惊群现象(一个连接将多个进程唤醒,但只有一个进程处理连接),nginx默认开启 连接数多建议关闭
  multi_accept on; # 单个进程是否能同时接受多个链接,连接数不多场景适合开启,较多时建议关闭
  worker_connections  1024; # worker最大连接数
}

http {
  # 文件扩展名与类型映射表
  include mime.types;

  # 默认文件类型
  default_type application/octet-stream;

  # log_format指令，用于定义日志格式 $remote_addr $http_x_forwarded_for为客户端地址 $remote_user客户名称
  # $time_local 访问时间与时区 $request请求url及协议 $status请求状态
  # $body_bytes_sent 发送的body字节 $http_referer 访问来源 $http_user_agent 客户端信息
  log_format        main '$remote_addr - $remote_user [$time_local] "$request" '
                         '$status $body_bytes_sent "$http_referer" '
                         '"$http_user_agent" "$http_x_forwarded_for"';

  # 访问日志
  access_log        /dev/stdout main;

  # 高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。
  # 图片异常可以尝试关闭此项
  sendfile          on;
  # 每个进程调用的传输数量限制, 默认0不限制
  #sendfile_max_chunk          0;
  # 提升网络包的传输效率。如果开启了，服务器需要给客户端发送数据时，并不是立即发送，而是等待一个缓冲区存满后再一起发送
  tcp_nopush        on;
  # 该指令必须在keep-alive连接开启的情况下才生效，来提高网络包传输的'实时性'。有数据就发
  tcp_nodelay        on;

  # 长连接超时时间,nginx默认75s,建议设置为65s(略低于负载均衡器的超时时间)
  keepalive_timeout 65;
  # 长连接使用次数,nginx默认100,建议根据实际情况调整
  keepalive_requests 100;

  # gzip压缩配置（放在 http 块中，所有 server 共享）
  gzip on; # 启用gzip
  gzip_comp_level 5; # 压缩级别, 最大9, 5是性能和压缩率的平衡点
  gzip_min_length 1024; # 最小压缩1k,小于1k的文件压缩意义不大
  gzip_buffers 16 8k; # 压缩缓冲区, 16个8k
  gzip_proxied any; # 对代理服务的响应压缩
  gzip_vary on; # 告知客户端支持压缩,添加Vary: Accept-Encoding响应头
  gzip_static on; # 预压缩（on: 如果预压缩文件不存在则动态压缩; always: 必须存在预压缩文件）
  gzip_disable "MSIE [1-6]\."; # 指定ie6以下不开启gzip压缩
  gzip_types text/plain text/css text/js text/xml text/javascript application/javascript application/json application/xml application/rss+xml image/svg+xml;

  # brotli压缩配置（需要安装 nginx-module-brotli 模块，需要启用SSL证书）
  # 可以与gzip并存,优先采用brotli,不支持回退到gzip压缩
  # brotli on; # 启用brotli
  # brotli_comp_level 6; # 压缩级别 最大11
  # brotli_min_length 1k; # 大于等于1k执行压缩
  # brotli_buffers 16 8k; # 压缩缓冲区, 16个8k
  # brotli_vary on; # 告知客户端支持压缩
  # brotli_static always; # 是否允许查找已压缩好的.br文件
  # brotli_types text/plain text/css text/js text/xml text/javascript application/javascript application/json application/xml application/rss+xml image/svg+xml;

  # 包含 server 配置文件
  include /etc/nginx/conf.d/*.conf;
}
